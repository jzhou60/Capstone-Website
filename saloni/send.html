<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- <script src="d3-scale-radial.js"></script> -->
  <style>
    text {
      font-size: 14px;
      font-family: monospace;
    }
	
	.line {
				fill: none;
				stroke: grey;
				stroke-width: 0.5;
			}
		h1	{
				color: #999999;
				font-family: arial, sans-serif;
				font-weight: bold;
				margin-top: 0px;
				margin-bottom: 1px;
				margin-left: 20px;
			}
			
	 #form{margin:30px}
  </style>
</head>

<body>
<div class="container-fluid">
      <div class="row">
			  <h1 align="center">Chicago Exploratory Analysis</h1>
			  <div class="col-sm-8" id="chartArea">
			  </div>
			  <div class="col-sm-1">
			  </div>
			  <div class="col-sm-3" >
			  <form id="form">
				<input type="radio" name="stack" value="TimeSeries">Time Series<br>
				<input type="radio" name="stack" value="CommPCA" >CommPCA<br>
				<input type="radio" name="stack" value="CommAutoEncoder">CommAutoEncoder<br>
				<input type="radio" name="stack" value="InOutFlowAutoEncoder">InOutFlowAutoEncoder<br>
				<input type="radio" name="stack" value="InOutFlowPCA">InOutFlowPCA<br>
				<input type="radio" name="stack" value="Comm">Comm<br>
	          </form>
			  </div>
      </div> 
	  
      	  
   
	  
	  
	  </div>

  <script>
            var w = document.getElementById('chartArea').clientWidth;
            var h = w /2;
			var padding = 80;
			
			var dataset, xScale, yScale, xAxis, yAxis, line;  //Empty, for now

			//For converting Dates to strings
			var formatTime = d3.timeFormat("%b %Y");
            var parseTime = d3.timeParse("%Y-%m-%d");
			//Function for converting CSV values from strings to Dates and numbers
			var DateCoverter = function(d) {
				return {
					date: parseTime(d.date),  //Make a new Date object for each year + month
					amount: parseFloat(d.amount),
					Type: parseFloat(d.Type),
					TimeSeries: parseFloat(d.TimeSeries),
					CommPCA: parseFloat(d.CommPCA),
					CommAutoEncoder: parseFloat(d.CommAutoEncoder),
					InOutFlowAutoEncoder: parseFloat(d.InOutFlowAutoEncoder),
					InOutFlowPCA: parseFloat(d.InOutFlowPCA),
					Comm: parseFloat(d.Comm)//Convert from string to float
				};
			}

			//Load in data
			d3.csv("Chicago_Results.csv",DateCoverter, function(data) {

				var dataset = data;

				xScale = d3.scaleTime()
							   .domain([
									d3.min(dataset, function(d) { return d.date; }),
									d3.max(dataset, function(d) { return d.date; })
								])
							   .range([padding, w-padding]);

				yScale = d3.scaleLinear()
								.domain([0, d3.max(dataset, function(d) { return d.amount; })])
								.range([h - padding, 90]);

				//Define axes
				xAxis = d3.axisBottom()
						   .scale(xScale)
						   .ticks(12)
						   .tickFormat(formatTime);

				//Define Y axis
				yAxis = d3.axisLeft()
						   .scale(yScale)
						   .ticks(10);

				//Define line generator
				line4 = d3.line()
							.defined(function(d) { return d.amount>= 0; })
							.x(function(d) { return xScale(d.date); })
							.y(function(d) { return yScale(d.amount); });
				
				//Create SVG element
				var svg = d3.select("#chartArea")
							.append("svg")
							.attr("width", w)
							.attr("height", h);
				
				svg.append("path")
					.datum(dataset)
					.attr("class", "line")
					.attr("d", line4)
					
       
				svg.selectAll('circle')
				   .data(dataset.filter(function(d) {return d.Type > 0}))
				   .enter()
				   .append('circle')
				   .attr("cx",function(d) { return xScale(d.date);})
				   .attr("cy",function(d) { return yScale(d.amount); })
				   .attr("r", 3)
				   .attr("fill","red")
				   .attr("class","events");
				svg.append("line").attr("x1",w-87).attr("y1",30).attr("x2", w-80).attr("y2", 30).attr("stroke-width", 1).attr("stroke", "grey")
				svg.append("circle").attr("cx",w-84).attr("cy",60).attr("r", 3).style("fill", "red")
				svg.append("text").attr("x", w-70).attr("y", 30).text("Total Ridership").style("font-size", "12px").attr("alignment-baseline","middle")				
				svg.append("text").attr("x", w-70).attr("y", 60).text("Actual_Events").style("font-size", "12px").attr("alignment-baseline","middle")
				

				//Create axes
				svg.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(0," + (h - padding) + ")")
					.call(xAxis);

				svg.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(" + padding + ",0)")
					.call(yAxis);
				
					
				svg.append("text")
				  .attr("transform", "rotate(-90)")
				  .attr("y", 5)
				  .attr("x",-180)
				  .attr("dy", "1em")
				  .style("text-anchor", "middle")
				  .text("Total Ridership")
				  .attr("fill","black")
				  
				d3.selectAll("input[name='stack']").on("change", function(){
				var column = this.value
				function key(d)
				{
				  return d.date;
				}
				console.table(dataset.filter(function(d) {return d[column] > 0}))
                var circles2= svg.selectAll('.Radio')
				   .data(dataset.filter(function(d) {return d[column] > 0}),key)
				   
				circles2.enter()
				   .append('circle')
				   .attr("cx",function(d) { return xScale(d.date);})
				   .attr("cy",function(d) { return yScale(d.amount); })
				   .attr("r", 3)
				   .attr("fill","green")
				   .attr("opacity",0.5)
				   .attr("class","Radio")
				   .merge(circles2);
				   
				circles2.exit().remove();
});

});
				


			
   
	
	
    
  </script>
</body>
</html>